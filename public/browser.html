<!DOCTYPE html>
<html ng-app="app">
<head>
<script  type="text/javascript" src="/socket.io/socket.io.js"></script>
<script  type="text/javascript" src="/public/js/Math.uuid.js"></script>
<script  type="text/javascript" src="/public/js/detector.js"></script>

<script  type="text/javascript">
	
	var socket = io.connect('http://localhost:3000/worker');

	socket.on('connect',function(){
		console.log('connected');

		var guid = Math.uuid(8, 16);
		socket.emit('register',{
			id:guid,
			browser:{
				name:bowser.name,
				version:bowser.version
			}
		});

		socket.on('job', function (job) {
			var w=window.open(job.url);
			injectScript(w.document,'http://localhost:3000/public/test.js')
		});

		socket.on('disconnect', function () {
			
	  	});

	})

	function injectScript(doc,url) {
		var script = doc.createElement('script');
		script.type = 'text/javascript';
		script.async = true;
		script.src = url;
		var container = doc.getElementsByTagName('head')[0];
		container.appendChild(script);
	}

</script>
</head>

<body ng-controller="Controller">

</body>
</html>